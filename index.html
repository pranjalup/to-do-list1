<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player One's Planner - Stable</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #050505; color: #e5e7eb; }
        .font-digital { font-family: 'JetBrains Mono', monospace; }
        
        /* Animations */
        @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fade-in 0.5s ease-out forwards; }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #101010; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #0070d1; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'https://esm.sh/react@18.2.0';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
            LayoutDashboard, Settings, Plus, Heart, Menu, X, 
            Sun, Cloud, CloudRain, Wind, Droplets, Play, Pause, 
            Music, Youtube, Clock, Folder, FileText, Image as ImageIcon, 
            Trash2, Upload, Camera, Type, StickyNote, Gamepad2, Trophy, 
            ExternalLink, Briefcase, Dumbbell, Utensils, Coffee, Moon, 
            SunMedium, Power, Headphones, Radio, ListMusic, Mic2
        } from 'https://esm.sh/lucide-react@0.263.1';
        
        import { get, set, del } from 'https://unpkg.com/idb-keyval@6.2.1/dist/index.js?module';

        // --- UTILITIES ---
        const getYoutubeId = (url) => { 
            if(!url) return null;
            const match = url.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/); 
            return (match && match[2].length === 11) ? match[2] : null; 
        };

        const getSpotifyEmbedUrl = (url) => {
            if (!url) return null;
            try {
                if (url.includes('/embed/')) return url;
                const urlObj = new URL(url);
                if (urlObj.hostname.includes('spotify.com')) {
                     return `https://open.spotify.com/embed${urlObj.pathname}`;
                }
            } catch(e) { return null; }
            return null;
        };

        const fileToBase64 = (file) => new Promise((resolve, reject) => { 
            const reader = new FileReader(); 
            reader.readAsDataURL(file); 
            reader.onload = () => resolve(reader.result); 
            reader.onerror = error => reject(error); 
        });

        // --- COMPONENTS ---

        // 1. ROBUST YOUTUBE PLAYER (No External API calls to prevent crash)
        const YouTubePlayer = ({ videoId, isRadioMode }) => {
            // If Radio Mode is on, we append &list=RD + videoId to trigger YouTube's internal infinite mix
            const src = isRadioMode 
                ? `https://www.youtube.com/embed/${videoId}?autoplay=1&list=RD${videoId}` 
                : `https://www.youtube.com/embed/${videoId}?autoplay=1`;

            return (
                <div className="w-full h-full rounded-lg overflow-hidden bg-black border border-[#333] shadow-lg relative">
                     <iframe 
                        width="100%" 
                        height="100%" 
                        src={src} 
                        title="YouTube video player" 
                        frameBorder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                        allowFullScreen
                        className="absolute inset-0"
                    ></iframe>
                </div>
            );
        };

        // 2. NATIVE PDF VIEWER (Safe Fallback)
        const PdfViewer = ({ url, name }) => {
            return (
                <div className="w-full h-full flex flex-col bg-[#101010]">
                    <div className="bg-[#1a1a1a] p-3 border-b border-[#333] flex justify-between items-center">
                        <span className="text-xs font-bold text-gray-400 flex items-center gap-2"><FileText size={14}/> {name}</span>
                        <a href={url} download={name} className="text-xs text-[#0070d1] hover:underline flex items-center gap-1"><Upload size={12} className="rotate-180"/> Download</a>
                    </div>
                    <div className="flex-1 relative">
                        <object data={url} type="application/pdf" className="w-full h-full">
                            <div className="flex flex-col items-center justify-center h-full text-gray-500 gap-2">
                                <p>Preview not supported in this view.</p>
                                <a href={url} target="_blank" className="bg-[#0070d1] text-white px-4 py-2 rounded hover:bg-blue-600 transition">Open PDF</a>
                            </div>
                        </object>
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---
        const StudentPlanner = () => {
            // State
            const [activeTab, setActiveTab] = useState('dashboard');
            
            // Media State
            const [mediaType, setMediaType] = useState('lofi'); // lofi, spotify, youtube
            const [ytInput, setYtInput] = useState('');
            const [ytVideoId, setYtVideoId] = useState('jfKfPfyJRdk'); // Default Lofi Girl
            const [isRadioMode, setIsRadioMode] = useState(false);
            const [spotifyLink, setSpotifyLink] = useState('https://open.spotify.com/embed/playlist/37i9dQZF1DX8Uebhn9wzrS');

            // Lofi Presets (These enable Radio Mode automatically)
            const playLofi = (id) => {
                setMediaType('youtube');
                setYtVideoId(id);
                setIsRadioMode(true); // Force radio mode for lofi buttons
            };

            // Weather (Mocked to prevent API fetch failure on load)
            const [weather, setWeather] = useState({ temp: 24, condition: 'Clear', city: 'Local' });

            // Tasks
            const [tasks, setTasks] = useState([
                { id: 1, text: 'Finish Project Report', done: false },
                { id: 2, text: 'Gym: 6:00 PM', done: true }
            ]);
            const [newTask, setNewTask] = useState('');

            // File System
            const [files, setFiles] = useState([]);
            const [viewingFile, setViewingFile] = useState(null);
            const fileInputRef = useRef(null);

            // Handlers
            const handleYtSubmit = () => {
                const id = getYoutubeId(ytInput);
                if (id) {
                    setYtVideoId(id);
                    setYtInput('');
                } else {
                    alert("Invalid YouTube URL");
                }
            };

            const handleSpotifySubmit = () => {
                 const url = getSpotifyEmbedUrl(ytInput); // reusing input for simplicity
                 if(url) {
                     setSpotifyLink(url);
                     setYtInput('');
                 } else {
                     alert("Invalid Spotify Link");
                 }
            };

            const handleFileUpload = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const base64 = await fileToBase64(file);
                const newFile = {
                    id: Date.now(),
                    name: file.name,
                    type: file.type === 'application/pdf' ? 'pdf' : 'image',
                    data: base64
                };
                setFiles([...files, newFile]);
            };

            return (
                <div className="flex h-screen overflow-hidden selection:bg-[#0070d1] selection:text-white">
                    
                    {/* Sidebar */}
                    <div className="w-64 bg-[#0a0a0a] border-r border-[#333] flex flex-col hidden md:flex">
                        <div className="p-6 border-b border-[#333]">
                            <h1 className="text-xl font-bold text-white flex items-center gap-2"><Gamepad2 className="text-[#0070d1]"/> Player One</h1>
                        </div>
                        <div className="p-4 space-y-1">
                            <button onClick={() => setActiveTab('dashboard')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${activeTab === 'dashboard' ? 'bg-[#0070d1] text-white' : 'text-gray-400 hover:bg-[#1f1f1f]'}`}>
                                <LayoutDashboard size={18} /> Dashboard
                            </button>
                            <button onClick={() => setActiveTab('resources')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${activeTab === 'resources' ? 'bg-[#0070d1] text-white' : 'text-gray-400 hover:bg-[#1f1f1f]'}`}>
                                <Folder size={18} /> Resources
                            </button>
                        </div>
                        <div className="mt-auto p-4 border-t border-[#333]">
                            <div className="text-xs text-gray-600 text-center">System Stable v4.0</div>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="flex-1 flex flex-col bg-[#050505] relative">
                        
                        {/* Header */}
                        <header className="h-16 border-b border-[#333] flex items-center justify-between px-8 bg-[#0a0a0a]/50 backdrop-blur-md">
                            <h2 className="text-white font-medium capitalize">{activeTab}</h2>
                            <div className="flex items-center gap-4 text-sm text-gray-400">
                                <span className="flex items-center gap-2"><Sun size={14}/> {weather.temp}Â°C</span>
                                <span className="w-px h-4 bg-[#333]"></span>
                                <span className="text-[#0070d1] font-mono">{new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                            </div>
                        </header>

                        {/* Scrollable Area */}
                        <div className="flex-1 overflow-y-auto p-8">
                            
                            {/* DASHBOARD VIEW */}
                            {activeTab === 'dashboard' && (
                                <div className="grid grid-cols-1 lg:grid-cols-12 gap-6 animate-fade-in">
                                    
                                    {/* Media Player Section */}
                                    <div className="lg:col-span-8 space-y-6">
                                        <div className="bg-[#1f1f1f] border border-[#333] rounded-xl p-6">
                                            <div className="flex justify-between items-center mb-4">
                                                <h3 className="text-white font-bold flex items-center gap-2"><Headphones size={20} className="text-[#0070d1]"/> Media Station</h3>
                                                <div className="flex bg-[#101010] p-1 rounded-md border border-[#333]">
                                                    <button onClick={() => setMediaType('youtube')} className={`p-2 rounded ${mediaType === 'youtube' ? 'bg-red-600 text-white' : 'text-gray-400 hover:text-white'}`}><Youtube size={16}/></button>
                                                    <button onClick={() => setMediaType('spotify')} className={`p-2 rounded ${mediaType === 'spotify' ? 'bg-green-600 text-white' : 'text-gray-400 hover:text-white'}`}><Music size={16}/></button>
                                                </div>
                                            </div>

                                            {/* YouTube View */}
                                            {mediaType === 'youtube' && (
                                                <div className="space-y-4">
                                                    <div className="flex gap-2">
                                                        <input 
                                                            type="text" 
                                                            value={ytInput}
                                                            onChange={(e) => setYtInput(e.target.value)}
                                                            onKeyDown={(e) => e.key === 'Enter' && handleYtSubmit()}
                                                            placeholder="Paste YouTube Link..." 
                                                            className="flex-1 bg-[#101010] border border-[#333] rounded px-3 py-2 text-sm text-white focus:border-red-500 outline-none"
                                                        />
                                                        <button onClick={handleYtSubmit} className="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700"><Play size={16}/></button>
                                                        <button 
                                                            onClick={() => setIsRadioMode(!isRadioMode)} 
                                                            className={`px-3 py-2 rounded border text-xs font-bold uppercase flex items-center gap-1 ${isRadioMode ? 'bg-purple-900/30 text-purple-400 border-purple-500' : 'bg-[#101010] text-gray-500 border-[#333]'}`}
                                                            title="Auto-Suggest Infinite Mix"
                                                        >
                                                            <Radio size={14}/> Radio
                                                        </button>
                                                    </div>

                                                    {/* Quick Radio Buttons */}
                                                    <div className="flex gap-2 overflow-x-auto pb-2">
                                                        <button onClick={() => playLofi('jfKfPfyJRdk')} className="shrink-0 px-3 py-1.5 rounded bg-[#101010] border border-[#333] text-xs text-gray-300 hover:border-[#0070d1] hover:text-white flex items-center gap-1"><Sun size={12}/> Lofi Girl</button>
                                                        <button onClick={() => playLofi('d3d5K_dWv2Q')} className="shrink-0 px-3 py-1.5 rounded bg-[#101010] border border-[#333] text-xs text-gray-300 hover:border-[#0070d1] hover:text-white flex items-center gap-1"><Mic2 size={12}/> Hindi Lofi</button>
                                                        <button onClick={() => playLofi('jYFC3g6hHMA')} className="shrink-0 px-3 py-1.5 rounded bg-[#101010] border border-[#333] text-xs text-gray-300 hover:border-[#0070d1] hover:text-white flex items-center gap-1"><Mic2 size={12}/> English Lofi</button>
                                                        <button onClick={() => playLofi('4xDzrJKXOOY')} className="shrink-0 px-3 py-1.5 rounded bg-[#101010] border border-[#333] text-xs text-gray-300 hover:border-[#0070d1] hover:text-white flex items-center gap-1"><Moon size={12}/> Synthwave</button>
                                                    </div>

                                                    <div className="aspect-video">
                                                        <YouTubePlayer videoId={ytVideoId} isRadioMode={isRadioMode} />
                                                    </div>
                                                </div>
                                            )}

                                            {/* Spotify View */}
                                            {mediaType === 'spotify' && (
                                                <div className="space-y-4">
                                                     <div className="flex gap-2">
                                                        <input 
                                                            type="text" 
                                                            value={ytInput} 
                                                            onChange={(e) => setYtInput(e.target.value)}
                                                            placeholder="Paste Spotify Link..." 
                                                            className="flex-1 bg-[#101010] border border-[#333] rounded px-3 py-2 text-sm text-white focus:border-green-500 outline-none"
                                                        />
                                                        <button onClick={handleSpotifySubmit} className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"><Play size={16}/></button>
                                                    </div>
                                                    <div className="h-80 rounded-lg overflow-hidden border border-[#333]">
                                                        <iframe src={spotifyEmbedUrl} width="100%" height="100%" frameBorder="0" allow="encrypted-media"></iframe>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    {/* Task & Info Section */}
                                    <div className="lg:col-span-4 space-y-6">
                                        {/* Tasks */}
                                        <div className="bg-[#1f1f1f] border border-[#333] rounded-xl p-6">
                                            <div className="flex items-center justify-between mb-4">
                                                <h3 className="text-white font-bold flex items-center gap-2"><ListTodo size={20} className="text-green-400"/> Side Quests</h3>
                                            </div>
                                            <div className="space-y-2 max-h-60 overflow-y-auto custom-scrollbar mb-4">
                                                {tasks.map(t => (
                                                    <div key={t.id} className="flex items-center gap-2 group">
                                                        <button onClick={() => setTasks(tasks.map(i => i.id === t.id ? {...i, done: !i.done} : i))} className={`w-5 h-5 rounded border flex items-center justify-center ${t.done ? 'bg-green-500 border-green-500' : 'border-gray-600'}`}>
                                                            {t.done && <Check size={14} className="text-black"/>}
                                                        </button>
                                                        <span className={`text-sm flex-1 ${t.done ? 'text-gray-500 line-through' : 'text-gray-200'}`}>{t.text}</span>
                                                        <button onClick={() => setTasks(tasks.filter(i => i.id !== t.id))} className="text-gray-600 hover:text-red-500 opacity-0 group-hover:opacity-100"><Trash2 size={14}/></button>
                                                    </div>
                                                ))}
                                            </div>
                                            <div className="flex gap-2">
                                                <input type="text" value={newTask} onChange={(e) => setNewTask(e.target.value)} onKeyDown={(e) => e.key === 'Enter' && (setTasks([...tasks, {id:Date.now(), text:newTask, done:false}]), setNewTask(''))} placeholder="New task..." className="bg-[#101010] border border-[#333] rounded px-2 py-1 text-sm text-white flex-1 outline-none"/>
                                                <button onClick={() => {if(newTask) { setTasks([...tasks, {id:Date.now(), text:newTask, done:false}]); setNewTask(''); }}} className="bg-[#333] hover:bg-[#444] text-white p-1 rounded"><Plus size={18}/></button>
                                            </div>
                                        </div>

                                        {/* Lifestyle Panel */}
                                        <div className="bg-[#1f1f1f] border border-[#333] rounded-xl p-6">
                                            <h3 className="text-white font-bold flex items-center gap-2 mb-4"><Trophy size={20} className="text-yellow-400"/> Status</h3>
                                            <div className="grid grid-cols-2 gap-3">
                                                <div className="bg-[#101010] p-3 rounded border border-[#333]">
                                                    <div className="text-xs text-gray-500 flex items-center gap-1"><Dumbbell size={12}/> Gym</div>
                                                    <div className="text-white font-bold">Leg Day</div>
                                                </div>
                                                <div className="bg-[#101010] p-3 rounded border border-[#333]">
                                                    <div className="text-xs text-gray-500 flex items-center gap-1"><Coffee size={12}/> Energy</div>
                                                    <div className="text-white font-bold">85%</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* RESOURCES VIEW (PDFs) */}
                            {activeTab === 'resources' && (
                                <div className="animate-fade-in h-full flex flex-col">
                                    {viewingFile ? (
                                        <div className="flex-1 flex flex-col bg-[#101010] rounded-xl overflow-hidden border border-[#333]">
                                            <div className="bg-[#1f1f1f] p-3 border-b border-[#333] flex justify-between items-center">
                                                <span className="text-white font-bold">{viewingFile.name}</span>
                                                <button onClick={() => setViewingFile(null)} className="text-gray-400 hover:text-white"><X size={20}/></button>
                                            </div>
                                            <div className="flex-1 relative">
                                                {viewingFile.type === 'pdf' ? (
                                                    <PdfViewer url={viewingFile.data} name={viewingFile.name} />
                                                ) : (
                                                    <div className="flex items-center justify-center h-full"><img src={viewingFile.data} className="max-h-full max-w-full"/></div>
                                                )}
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="space-y-6">
                                            <div className="flex justify-between items-center">
                                                <h3 className="text-2xl font-bold text-white">My Files</h3>
                                                <input type="file" ref={fileInputRef} onChange={handleFileUpload} accept=".pdf,image/*" className="hidden" />
                                                <button onClick={() => fileInputRef.current.click()} className="bg-[#0070d1] hover:bg-blue-600 text-white px-4 py-2 rounded flex items-center gap-2"><Upload size={18}/> Upload</button>
                                            </div>
                                            
                                            {files.length === 0 ? (
                                                <div className="text-center text-gray-500 py-20 border-2 border-dashed border-[#333] rounded-xl">
                                                    <Folder size={48} className="mx-auto mb-2 opacity-50"/>
                                                    <p>No files yet. Upload a PDF to start.</p>
                                                </div>
                                            ) : (
                                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                                    {files.map(f => (
                                                        <div key={f.id} onClick={() => setViewingFile(f)} className="bg-[#1f1f1f] p-4 rounded-xl border border-[#333] hover:border-[#0070d1] cursor-pointer group transition-all">
                                                            <div className="w-10 h-10 bg-[#101010] rounded flex items-center justify-center mb-3">
                                                                {f.type === 'pdf' ? <FileText className="text-red-500"/> : <ImageIcon className="text-blue-500"/>}
                                                            </div>
                                                            <div className="text-sm text-white font-medium truncate">{f.name}</div>
                                                            <div className="text-xs text-gray-500">Added just now</div>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </div>
                            )}

                        </div>
                    </div>

                    {/* Fullscreen Overlay for File Viewing (Optional, integrated above instead) */}
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<StudentPlanner />);
    </script>
</body>
</html>
